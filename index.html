<!DOCTYPE html>
<html lang="en">

<head>
  <title>LINE Retail Society</title>
  <meta charset="utf-8">
  <meta content="" name="description">
  <meta content="" name="keywords">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-PW7HPDW');</script>
  <!-- End Google Tag Manager -->

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
  <link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet" type="text/css">
  <link href='css/ekachon.css' rel="stylesheet" type="text/css">
  <link href='css/style.css' rel="stylesheet" type="text/css">
  <link href='css/button.css' rel="stylesheet" type="text/css">
  <link href='css/w3.css' rel="stylesheet" type="text/css">
  <link href='css/app.css' rel="stylesheet" type="text/css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
  <script src="https://static.line-scdn.net/liff/edge/versions/2.12.0/sdk.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.5.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.5.0/firebase-firestore.js"></script>


</head>

<body id="myPage" data-spy="scroll" data-target=".navbar" data-offset="60" style="background-color: #ffffff;">
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PW7HPDW"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>


  <nav class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <a class="navbar-brand" href="index.html">Retail Society</a>
      </div>
    </div>
  </nav>

  <main id="main">
    <section id="team" class="team section-bg">
      <div class="container" id="CheckLogin">
        <div class="section-title" data-aos="fade-up" style="margin-top:10px;">
          <div style="color:#0056ff;font-size:18px;margin-top:-20px;">LINE Retail Society</div>
          <div style="padding:15px 0px 15px 0px;">
            <center>
              <div style="margin-top:60px;font-size: 18px;color:#0056ff;line-height: 1.4;font-weight: 600;">ยินดีต้อนรับสู่<br>LINE Retail Society</div>
              <div style="margin-top:40px;"><img id="pictureUrl" class="imgprofile" style="width:140px;"></div>
              <div style="color:#0056ff;font-weight: 700; font-size:16px;margin-top:12px;"><p id="displayName"></p></div>
              <div id="loading" style="margin-top:20px;text-align: center;"><img src="./img/loading.gif"></div>
              <div id="UserYesReg" style="display:none;">
                <div class="btn-t2" onclick="ClickCheckLogin()">ลงทะเบียนเข้าใช้งาน</div>
                <div style="padding-top:25px;color:#555555;">ขอความร่วมมือในการกรอกข้อมูลของท่าน<br>ก่อนเริ่มการเข้าใช้งาน <b>LINE Retail Society</b><br><br><br>*** ขอสงวนสิทธิ์การเข้าใช้งานเฉพาะชาว Retail เท่านั้น ***</div>
              </div>
              <div id="UserNoReg" style="display:none;">
              </div>
            </center>
          </div>

        </div>
      </div>


      <div class="container" id="CheckProfile" style="display: none;">
        <div class="section-title" data-aos="fade-up">
          <center>
          <div style="font-size: 16px;margin-top:90px;font-weight: 600;color:#000;">แก้ไขข้อมูลของคุณ</div>
          <div style="margin-top:20px;"><img id="pictureUrl1" class="imgprofile"></div>
          <div style="color:#0056ff;font-weight: 700; font-size:16px;"><p id="displayName1"></p></div>
          </center>
          <div style="color:#888888;text-align: left;padding:5px 30px;margin-top:15px;font-size:12px;">
            <div>รหัสพนักงาน (ttb bank) <font color="#ff0000">*</font></div>
            <div style="color:#0056ff;"><input type="number" id="empid" placeholder="รหัสพนักงาน .." pattern="[+-]?[0-9]" required></div>
            <p id="empid_req" style="color:#ff0000;"></p>
            <div>ชื่อ-นามสกุล (ภาษาไทย) <font color="#ff0000">*</font></div>
            <div style="color:#0056ff;"><input type="text" id="fname" placeholder="ชื่อ นามสกุล .." required></div>
            <p id="fname_req" style="color:#ff0000;"></p>
            <div>โทรศัพท์มือถือ</div>
            <div style="color:#0056ff;"><input type="text" name="phone" id="phone" pattern="[+-]?[0-9]"></div>
            <div>สังกัดหน่วยงาน</div>
            <div style="color:#0056ff;">
              <select name="cars" id="br">
                <option value="BBD" selected>BBD Team (สาขา, สำนักงานเขต, สำนักงานภาค)</option>
                <option value="RASC">RSAC Team</option>
                <option value="PRODUCT">PRODUCT Team</option>
                <option value="OCSE">OCSE Team</option>
                <option value="CHIEF">CHIEF Team</option>
                <option value="OTHER">Other</option>
              </select>
            </div>
            <div>สำนักงานภาค</div>
            <div style="color:#0056ff;">
              <select name="addrh" id="rh">
                <option value="RH1">สำนักงานภาคธุรกิจสาขา 1</option>
                <option value="RH2">สำนักงานภาคธุรกิจสาขา 2</option>
                <option value="RH3">สำนักงานภาคธุรกิจสาขา 3</option>
                <option value="RH4">สำนักงานภาคธุรกิจสาขา 4</option>
                <option value="RH5">สำนักงานภาคธุรกิจสาขา 5</option>
                <option value="RH6">สำนักงานภาคธุรกิจสาขา 6</option>
                <option value="RH7">สำนักงานภาคธุรกิจสาขา 7</option>
                <option value="Oth">อื่น ๆ</option>
              </select>
            </div>
            <!--
            <div>สังกัดหน่วยงาน</div>
            <div><input type="text" id="br" placeholder="หน่วยงาน / สาขา (รหัสสาขา) .."></div>
            <div>Email@ttbbank.com</div>
            <div><input type="text" id="email" placeholder="ระบุอีเมล์ .."></div>
            -->
            <div>ที่อยู่สาขาสำหรับการจัดส่งของรางวัล (กรณีที่ได้รับรางวัล)</div>
            <div style="color:#0056ff;"><textarea id="address" placeholder="ที่อยู่สาขาสำหรับการจัดส่งของรางวัล .." style="height:100px"></textarea></div>
            <div>ระบุเหตุผลในการเข้าใช้งาน <font color="#ff0000">*</font></div>
            <div style="color:#0056ff;"><textarea id="memo" placeholder="โปรดระบุ .." style="height:100px" required></textarea></div>
            <p id="memo_req" style="color:#ff0000;"></p>
            <center><div class="btn-t2" onclick="ClickSaveProfile()">บันทึกรายการ</div></center>
            <div class="clr" style="height: 30px;"></div>
          </div>
        </div>
      </div>


      <div class="container" id="UserWaitting" style="display: none;background:#ffffff;margin-bottom: 50px;width:95%;border-radius: 15px;">
        <div class="section-title" data-aos="fade-up">
          <center>
            <div class="btn-t2" onclick="ClickCheckLogin()">อยู่ระหว่างตรวจสอบข้อมูล</div>
            <div style="padding-top:25px;color:#55555;"><font color="#ff0000"><b>
              ขณะนี้อยู่ในขั้นตอนการตรวจสอบข้อมูลการลงทะเบียนของคุณ<br>
              โปรดรอการตรวจข้อมูลสอบภายใน 24 ชั่วโมง</b></font><br><br>
            *** ขอสงวนสิทธิ์การเข้าใช้งานเฉพาะชาว Retail เท่านั้น ***</div>

          </center>
          <div class="clr" style="height: 40px;"></div>
        </div>
      </div>


      <div class="container" id="PleaseRegister" style="display: none;background:#ffffff;margin-bottom: 50px;width:95%;border-radius: 15px;">
        <div class="section-title" data-aos="fade-up">
          <center>
            <div class="btn-t2" onclick="ClickCheckLogin()">กรุณาลงทะเบียนก่อนเริ่มใช้งาน</div>
            <div style="padding-top:25px;color:#55555;"><font color="#ff0000"><b>
              ขอให้ทำการลงทะเบียนเพื่อขอใช้งาน LINE Retail Society<br></b></font><br><br>
            *** ขอสงวนสิทธิ์การเข้าใช้งานเฉพาะชาว Retail เท่านั้น ***</div>

          </center>
          <div class="clr" style="height: 40px;"></div>
        </div>
      </div>


      <div class="container" id="UserBlocked" style="display: none;background:#ffffff;margin-bottom: 50px;width:95%;border-radius: 15px;">
        <div class="section-title" data-aos="fade-up">
          <center>
            <div class="btn-t3" onclick="ClickCheckLogin()">กรุณาตรวจสอบข้อมูลอีกครั้ง</div>
            <div style="padding-top:25px;color:#55555;"><font color="#ff0000"><b>
              ข้อมูลของคุณไม่ถูกต้อง ระบบไม่อนุญาตให้เข้าใช้งาน<br>
              กรุณาติดต่อผ่านช่องทาง Email<br>เพื่อขอเปิดใช้งาน LINE Retail Society</b></font><br>
              *** ขอสงวนสิทธิ์การเข้าใช้งานเฉพาะชาว Retail เท่านั้น ***<br><br>
              <div class="btn-t1" onclick="window.location.href='mailto: suvit.cha@ttbbank.com?subject=ขอเปิดการใช้งาน LINE Retail Society'">คลิกเพื่อส่ง Email</div>
              </div>

          </center>
          <div class="clr" style="height: 40px;"></div>
        </div>
      </div>


    </section>
    <center>
    <div style="margin-top:30px;font-size:10px;color:#555555;margin-bottom: 20px;font-weight: 700;">@LINE Retail Socitey</div>
    <div><div id="isLoggedIn" style="color:#ffffff;"></div><div id="userId" style="color:#ffffff;"></div></div>
    </center>
  </main>
  </div>
  <a href="#" class="back-to-top"><i class="icofont-simple-up"></i></a>

  <!-- Template Main JS File 
  <script src="js/config.js"></script>-->
<script src="./js/session.js?ver=0002"></script>

<script type="text/javascript">
  var sstatusconfirm = 1;
  var aCheck = 0;
  var Eid = "";
  var dateString = new Date().toLocaleString('en-US', { timeZone: 'Asia/Jakarta' });


  async function main() {
    //await liff.init({ liffId: "1655966947-pvwn54O3" });
    function _0x51ad(){var _0x1daa12=['507881MNKeel','60kADfQk','675626UiQbhI','26788joBNPx','855mPwhfF','32jLznmn','init','22180XwEdWZ','4kQSSoO','2204076JbvbFA','138zDliUE','133629GTjuPG','345720lLAsml'];_0x51ad=function(){return _0x1daa12;};return _0x51ad();}var _0x84dbe8=_0xe581;function _0xe581(_0x1f2da1,_0x30500f){var _0x51ada0=_0x51ad();return _0xe581=function(_0xe581c0,_0x5611ae){_0xe581c0=_0xe581c0-0x1a7;var _0x3796cf=_0x51ada0[_0xe581c0];return _0x3796cf;},_0xe581(_0x1f2da1,_0x30500f);}(function(_0x7e1e19,_0x1919fa){var _0x51fa3d=_0xe581,_0x41263d=_0x7e1e19();while(!![]){try{var _0x10b1ae=parseInt(_0x51fa3d(0x1b2))/0x1*(parseInt(_0x51fa3d(0x1af))/0x2)+parseInt(_0x51fa3d(0x1b1))/0x3*(-parseInt(_0x51fa3d(0x1aa))/0x4)+-parseInt(_0x51fa3d(0x1b3))/0x5+parseInt(_0x51fa3d(0x1b0))/0x6+-parseInt(_0x51fa3d(0x1a9))/0x7*(-parseInt(_0x51fa3d(0x1ac))/0x8)+parseInt(_0x51fa3d(0x1ab))/0x9*(-parseInt(_0x51fa3d(0x1ae))/0xa)+parseInt(_0x51fa3d(0x1a7))/0xb*(-parseInt(_0x51fa3d(0x1a8))/0xc);if(_0x10b1ae===_0x1919fa)break;else _0x41263d['push'](_0x41263d['shift']());}catch(_0xc3cf79){_0x41263d['push'](_0x41263d['shift']());}}}(_0x51ad,0x314b1),await liff[_0x84dbe8(0x1ad)]({'liffId':'1655966947-MK92yKlq'}));
    document.getElementById("isLoggedIn").append(liff.isLoggedIn());
    if(liff.isLoggedIn()) {
      getUserProfile();
    } else {
      liff.login();
    }
  }
  main()


  var getPicture = "";
  async function getUserProfile() {
    const profile = await liff.getProfile();
    document.getElementById("pictureUrl").src = profile.pictureUrl;
    document.getElementById("pictureUrl1").src = profile.pictureUrl;
    document.getElementById("userId").append(profile.userId);
    document.getElementById("displayName").append(profile.displayName);
    document.getElementById("displayName1").append(profile.displayName);
    sessionStorage.setItem("LineLogin", profile.userId);
    sessionStorage.setItem("LineID", profile.userId);
    sessionStorage.setItem("LineName", profile.displayName);
    sessionStorage.setItem("LinePicture", profile.pictureUrl);
    getPicture = profile.pictureUrl;
    ReadData();
  }


  function openWindow() {
    liff.openWindow({
      url: "https://line.me",
      external: true     
    })
  }

function _0x311d(_0x2e51fb,_0x53cdd1){var _0x3b9165=_0x3b91();return _0x311d=function(_0x311d95,_0x222822){_0x311d95=_0x311d95-0x1f0;var _0x43bf56=_0x3b9165[_0x311d95];return _0x43bf56;},_0x311d(_0x2e51fb,_0x53cdd1);}var _0x3d09ef=_0x311d;(function(_0xff84a1,_0x30902d){var _0x2bb2c2=_0x311d,_0x108122=_0xff84a1();while(!![]){try{var _0x47220e=parseInt(_0x2bb2c2(0x1f0))/0x1+-parseInt(_0x2bb2c2(0x1f3))/0x2+parseInt(_0x2bb2c2(0x1f9))/0x3*(parseInt(_0x2bb2c2(0x1fa))/0x4)+-parseInt(_0x2bb2c2(0x1f4))/0x5*(parseInt(_0x2bb2c2(0x1fb))/0x6)+parseInt(_0x2bb2c2(0x1f2))/0x7*(-parseInt(_0x2bb2c2(0x1f7))/0x8)+-parseInt(_0x2bb2c2(0x200))/0x9+-parseInt(_0x2bb2c2(0x1fc))/0xa*(-parseInt(_0x2bb2c2(0x1f6))/0xb);if(_0x47220e===_0x30902d)break;else _0x108122['push'](_0x108122['shift']());}catch(_0x1116fb){_0x108122['push'](_0x108122['shift']());}}}(_0x3b91,0x390cc));function _0x3b91(){var _0x5eeedc=['AIzaSyDfTJJ425U4OY0xac6jdhtSxDeuJ-OF-lE','336oYPUfS','479490EAaxis','18620ikhBwf','1:653667385625:web:a5aed08500de80839f0588','13849OJRGVm','34064tJAyzr','retailproject-6f4fc.firebaseapp.com','39fXXISv','89592RWVPoi','12KgRHku','2230PvKeMU','retailproject-6f4fc','G-9SKTRHHSW9','retailproject-6f4fc.appspot.com','178209VyTyez','133123vaHKXg'];_0x3b91=function(){return _0x5eeedc;};return _0x3b91();}var firebaseConfig={'apiKey':_0x3d09ef(0x1f1),'authDomain':_0x3d09ef(0x1f8),'projectId':_0x3d09ef(0x1fd),'storageBucket':_0x3d09ef(0x1ff),'messagingSenderId':'653667385625','appId':_0x3d09ef(0x1f5),'measurementId':_0x3d09ef(0x1fe)};

var _0x488e58=_0x4e27;(function(_0x32753c,_0x1ca7bf){var _0x25ebfa=_0x4e27,_0x31716a=_0x32753c();while(!![]){try{var _0x51c485=-parseInt(_0x25ebfa(0x1f9))/0x1*(-parseInt(_0x25ebfa(0x1f6))/0x2)+parseInt(_0x25ebfa(0x1fc))/0x3+parseInt(_0x25ebfa(0x1f3))/0x4+-parseInt(_0x25ebfa(0x1fa))/0x5*(parseInt(_0x25ebfa(0x1f8))/0x6)+parseInt(_0x25ebfa(0x1f7))/0x7+parseInt(_0x25ebfa(0x1f4))/0x8*(-parseInt(_0x25ebfa(0x1fd))/0x9)+-parseInt(_0x25ebfa(0x1f5))/0xa*(-parseInt(_0x25ebfa(0x1fb))/0xb);if(_0x51c485===_0x1ca7bf)break;else _0x31716a['push'](_0x31716a['shift']());}catch(_0x48c30d){_0x31716a['push'](_0x31716a['shift']());}}}(_0x5ccd,0x3e554),firebase[_0x488e58(0x1fe)](firebaseConfig));function _0x5ccd(){var _0x3d3f35=['2551385rXOdcd','537724rcwvGb','134994iulnmT','225qeAJkD','initializeApp','collection','CheckProfile','1940676pBIBjZ','128416utgmZO','60shxlBr','3728ZbyGxI','1973370gyRtvx','6NOpCZi','33dNAXNW'];_0x5ccd=function(){return _0x3d3f35;};return _0x5ccd();}function _0x4e27(_0x290f2f,_0xd87729){var _0x5ccdac=_0x5ccd();return _0x4e27=function(_0x4e27bb,_0x501053){_0x4e27bb=_0x4e27bb-0x1f1;var _0x155696=_0x5ccdac[_0x4e27bb];return _0x155696;},_0x4e27(_0x290f2f,_0xd87729);}var db=firebase['firestore']()[_0x488e58(0x1f1)](_0x488e58(0x1f2));



  function ClickCheckLogin() {
    if(sessionStorage.getItem("LineID")==null) { location.href = "index.html"; }
    document.getElementById('CheckProfile').style.display='block';
    document.getElementById('CheckLogin').style.display='none';
    document.getElementById('UserWaitting').style.display = 'none';
    document.getElementById('UserWaitting').style.display = 'none';
    document.getElementById('PleaseRegister').style.display = 'none';
  }



  function ReadData() {
    db.where('lineID','==',sessionStorage.getItem("LineID"))
    .get().then((snapshot)=> {
      snapshot.forEach(doc=> {
        //StatusConfirm 0 = ใหม่ , 1 = อนุมัติ , 2 = รออนุมัติ , 9 = ไม่อนุมัติ
        sessionStorage.setItem("StatusConfirm", doc.data().statusconfirm);
        sessionStorage.setItem("EmpID", doc.data().empID);
        sessionStorage.setItem("EmpName", doc.data().empName);
        sessionStorage.setItem("EmpBR", doc.data().empBr);
        sessionStorage.setItem("EmpRH", doc.data().empRH);
        sessionStorage.setItem("Address", doc.data().empAddress);
        sessionStorage.setItem("EmpPhone", doc.data().empPhone);      
        document.getElementById("empid").value = doc.data().empID;
        document.getElementById("fname").value = doc.data().empName;
        document.getElementById("phone").value = doc.data().empPhone;
        document.getElementById("br").value = doc.data().empBr;
        document.getElementById("rh").value = doc.data().empRH;
        document.getElementById("address").value = doc.data().empAddress;
        document.getElementById("memo").value = doc.data().memo;
        var ShowRegister = "เมื่อวันที่ : "+doc.data().RegisterDate;
        $("#RegisterDate").html(ShowRegister);
        Eid = doc.id;
        sstatusconfirm = doc.data().statusconfirm;

        aCheck = 1;
        //StatusConfirm 0 = ใหม่ , 1 = อนุมัติ , 2 = รออนุมัติ , 9 = ไม่อนุมัติ
        if(doc.data().statusconfirm==1) {
          UpdateLine();
          window.location.href = 'wow.html';
          //อนุมัติ
          //sessionStorage.getItem("StatusPass") = doc.data().statusconfirm;
          document.getElementById('loading').style.display = 'none';
          document.getElementById('UserWaitting').style.display = 'none';
          document.getElementById('UserNoReg').style.display = 'none';
          document.getElementById('UserYesReg').style.display = 'none';
          document.getElementById('PleaseRegister').style.display = 'none';
        } else if(doc.data().statusconfirm==2) {
          //รออนุมัติ
          document.getElementById('loading').style.display = 'none';
          document.getElementById('UserWaitting').style.display = 'block';
          document.getElementById('UserNoReg').style.display = 'none';
          document.getElementById('UserYesReg').style.display = 'none';
          document.getElementById('UserBlocked').style.display = 'none';
          document.getElementById('PleaseRegister').style.display = 'none';
        } else if(doc.data().statusconfirm==0) {
          //ขอเข้าใช้งาน
          sstatusconfirm = 2;
          document.getElementById('loading').style.display = 'none';
          document.getElementById('UserWaitting').style.display = 'none';
          document.getElementById('UserNoReg').style.display = 'none';
          document.getElementById('UserYesReg').style.display = 'none';
          document.getElementById('UserBlocked').style.display = 'none';
          document.getElementById('PleaseRegister').style.display = 'block';
        } else if(doc.data().statusconfirm==9) {
          //ไม่อนุมัติ
          document.getElementById('loading').style.display = 'none';
          document.getElementById('UserWaitting').style.display = 'none';
          document.getElementById('UserNoReg').style.display = 'none';
          document.getElementById('UserYesReg').style.display = 'none';
          document.getElementById('UserBlocked').style.display = 'block';
          document.getElementById('PleaseRegister').style.display = 'none';
        } else {
          document.getElementById('loading').style.display = 'none';
          document.getElementById('UserWaitting').style.display = 'none';
          document.getElementById('UserNoReg').style.display = 'none';
          document.getElementById('UserYesReg').style.display = 'none';
          document.getElementById('UserBlocked').style.display = 'block';
          document.getElementById('PleaseRegister').style.display = 'none';
        }
      });
      if(aCheck==0) {
        document.getElementById('loading').style.display = 'none';
        document.getElementById('UserWaitting').style.display = 'none';
        document.getElementById('UserNoReg').style.display = 'none';
        document.getElementById('UserYesReg').style.display = 'block';
        document.getElementById('UserBlocked').style.display = 'none';
        document.getElementById('PleaseRegister').style.display = 'none';
      }
    });
  }


function UpdateLine() {
  //alert("Update-3 "+Eid);
  db.doc(Eid).update({
    lineID : sessionStorage.getItem("LineID"),
    linename : sessionStorage.getItem("LineName"),
    empPicture : sessionStorage.getItem("LinePicture")
  });
  //alert("Update-3 "+sessionStorage.getItem("LinePicture"));

}


function ClickSaveProfile() {
  var GotoPage = 0;
  var CheckReq = 0;
  var inpObj = document.getElementById("empid");
  var inpObj1 = document.getElementById("fname");
  var inpObj2 = document.getElementById("memo");

  if (!inpObj.checkValidity()) {
    document.getElementById("empid_req").innerHTML = inpObj.validationMessage;
  } else {
    CheckReq = CheckReq+1;
    document.getElementById("empid_req").innerHTML = "";
  } 
  if (!inpObj1.checkValidity()) {
    document.getElementById("fname_req").innerHTML = inpObj1.validationMessage;
  } else {
    CheckReq = CheckReq+1;
    document.getElementById("fname_req").innerHTML = "";
  } 
  if (!inpObj2.checkValidity()) {
    document.getElementById("memo_req").innerHTML = inpObj2.validationMessage;
  } else {
    CheckReq = CheckReq+1;
    document.getElementById("memo_req").innerHTML = "";
  } 
  if(CheckReq==3) {
    if(document.getElementById("fname").value!="") { var a1 = document.getElementById("fname").value; } else { var a1 = "";}
    if(document.getElementById("empid").value!="") { var a2 = document.getElementById("empid").value; } else { var a2 = "";}
    if(document.getElementById("phone").value!="") { var a4 = document.getElementById("phone").value; } else { var a4 = "";}
    if(document.getElementById("br").value!="") { var a5 = document.getElementById("br").value; } else { var a5 = "";}
    if(document.getElementById("rh").value!="") { var a7 = document.getElementById("rh").value; } else { var a7 = "";}
    if(document.getElementById("address").value!="") { var a6 = document.getElementById("address").value; } else { var a6 = "";}
    if(a5!="BBD") { a7="Oth"; }
    if(document.getElementById("memo").value!="") { var a8 = document.getElementById("memo").value; } else { var a8 = "";}
    NewDate();
    if(aCheck==1) {
      //alert("Save "+sstatusconfirm);
      db.doc(Eid).update({
        lineID : sessionStorage.getItem("LineID"),
        linename : sessionStorage.getItem("LineName"),
        empPicture : sessionStorage.getItem("LinePicture"),
        empName : a1,
        empID : a2,
        empPhone : a4,
        empBr : a5,
        empRH : a7,
        empAddress : a6,   
        memo : a8, 
        statusconfirm : sstatusconfirm,  
        lastcheckin : dateString,
        RegisterDate : dateString
      });
      GotoPage = 1;
    } else {
      db.add({
        lineID : sessionStorage.getItem("LineID"),
        linename : sessionStorage.getItem("LineName"),
        empPicture : sessionStorage.getItem("LinePicture"),
        empName : a1,
        empID : a2,
        empPhone : a4,
        empBr : a5,
        empRH : a7,
        empAddress : a6,   
        memo : a8, 
        lastcheckin : dateString,
        RegisterDate : dateString,
        statusconfirm : 2,  
        statuspass : 0,
        statusedit : 1   
      });
      GotoPage = 1;
    }
    document.getElementById('id01').style.display='block';   
    if(GotoPage==1) {
      document.getElementById('CheckLogin').style.display='block';
      document.getElementById('CheckProfile').style.display='none';
      document.getElementById('DisplayList').style.display='none';
    }
    ReadData();

  }
}


function CloseAll() {
    ReadData();
    document.getElementById('id01').style.display='none';
}


function CloseAgenda() {
    document.getElementById('UserWaitting').style.display = 'none';
}

function GotoWeb() {
  window.location.href = 'register.html';
}



var aEmpBr = "OCSE";

function DisplayOCSE() {
  $('#tbresult').html('');
  document.getElementById('DisplayList').style.display='block';
  var table = document.querySelector('#tbresult');
  db.where('GroupReg','==',aGroupReg).get().then((snapshot)=> {
    snapshot.forEach(doc=>{
      showData(doc);
    });
  });
  var i = 0;


  function showData(doc) {
    i = i+1;
    var row = table.insertRow(-1);
    var cell1 = row.insertCell(0);
    var cell2 = row.insertCell(1);
    var cell3 = row.insertCell(2);
    //var cell4 = row.insertCell(3);
    cell1.innerHTML = '<div style="width:40px;text-align:center;">'+i+'</div>';
    cell2.innerHTML = '<div style="width:50px;text-align:center;"><img src="'+doc.data().empPicture+'" class="imgprofile-ss"></div>';
    cell3.innerHTML = '<span style="width:290px;color:#0056ff; font-size:12px;font-weight:600;">'+doc.data().linename+'</span><br><span style="color:#f68b1f; font-size:12px;">'+doc.data().empName+'</span><br><span style="color:#000000; font-size:10px;line-height: 1.2;">'+doc.data().empAddress+'</span><br><span style="color:#000000; font-size:10px;line-height: 1.2;">'+doc.data().empPhone+'</span>';
  }
}

function export2csv() {
  let data = "";
  const tableData = [];
  const rows = document.querySelectorAll("table tr");
  for (const row of rows) {
    const rowData = [];
    for (const [index, column] of row.querySelectorAll("th, td").entries()) {
      // To retain the commas in the "Description" column, we can enclose those fields in quotation marks.
      if ((index + 1) % 3 === 0) {
        rowData.push('"' + column.innerText + '"');
      } else {
        rowData.push(column.innerText);
      }
    }
    tableData.push(rowData.join(","));
  }
  data += tableData.join("\n");
  const a = document.createElement("a");
  a.href = URL.createObjectURL(new Blob([data], { type: "text/csv" }));
  a.setAttribute("download", "data.csv");
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
}


function phone_formatting(ele,restore) {
  var new_number,
      selection_start = ele.selectionStart,
      selection_end = ele.selectionEnd,
      number = ele.value.replace(/\D/g,'');
  
  // automatically add dashes
  if (number.length > 2) {
    // matches: 123 || 123-4 || 123-45
    new_number = number.substring(0,3) + '-';
    if (number.length === 4 || number.length === 5) {
      // matches: 123-4 || 123-45
      new_number += number.substr(3);
    }
    else if (number.length > 5) {
      // matches: 123-456 || 123-456-7 || 123-456-789
      new_number += number.substring(3,6) + '-';
    }
    if (number.length > 6) {
      // matches: 123-456-7 || 123-456-789 || 123-456-7890
      new_number += number.substring(6);
    }
  }
  else {
    new_number = number;
  } 
  ele.value =  (new_number.length > 12) ? new_number.substring(12,0) : new_number;
  document.getElementById('msg').innerHTML='<p>Selection is: ' + selection_end + ' and length is: ' + new_number.length + '</p>';
  
  if (new_number.slice(-1) === '-' && restore === false
      && (new_number.length === 8 && selection_end === 7)
          || (new_number.length === 4 && selection_end === 3)) {
      selection_start = new_number.length;
      selection_end = new_number.length;
  }
  else if (restore === 'revert') {
    selection_start--;
    selection_end--;
  }
  ele.setSelectionRange(selection_start, selection_end);

}
  
  
function phone_number_check(field,e) {
  var key_code = e.keyCode,
      key_string = String.fromCharCode(key_code),
      press_delete = false,
      dash_key = 189,
      delete_key = [8,46],
      direction_key = [33,34,35,36,37,38,39,40],
      selection_end = field.selectionEnd;
  
  // delete key was pressed
  if (delete_key.indexOf(key_code) > -1) {
    press_delete = true;
  }
  
  // only force formatting is a number or delete key was pressed
  if (key_string.match(/^\d+$/) || press_delete) {
    phone_formatting(field,press_delete);
  }
  // do nothing for direction keys, keep their default actions
  else if(direction_key.indexOf(key_code) > -1) {
    // do nothing
  }
  else if(dash_key === key_code) {
    if (selection_end === field.value.length) {
      field.value = field.value.slice(0,-1)
    }
    else {
      field.value = field.value.substring(0,(selection_end - 1)) + field.value.substr(selection_end)
      field.selectionEnd = selection_end - 1;
    }
  }
  // all other non numerical key presses, remove their value
  else {
    e.preventDefault();
//    field.value = field.value.replace(/[^0-9\-]/g,'')
    phone_formatting(field,'revert');
  }

}

document.getElementById('phone').onkeyup = function(e) {
  phone_number_check(this,e);
}


function GotoGame() {
  location.href = "wow.html";
}


function NewDate() {
  var today = new Date();
  var day = today.getDate() + "";
  var month = (today.getMonth() + 1) + "";
  var year = today.getFullYear() + "";
  var hour = today.getHours() + "";
  var minutes = today.getMinutes() + "";
  var seconds = today.getSeconds() + "";
  var ampm = hour >= 12 ? 'PM' : 'AM';

  day = checkZero(day);
  month = checkZero(month);
  year = checkZero(year);
  hour = checkZero(hour);
  minutes = checkZero(minutes);
  seconds = checkZero(seconds);

  dateString = day + "/" + month + "/" + (parseInt(year)+543) + " " + hour + ":" + minutes + ":" + seconds +" "+ ampm;
  //alert(GetNewDate);
  //console.log(day + "/" + month + "/" + year + " " + hour + ":" + minutes + ":" + seconds +" "+ ampm);
}

function checkZero(data){
  if(data.length == 1){
    data = "0" + data;
  }
  return data;
}

</script>

<div id="id01" class="w3-modal w3-animate-opacity">
  <div class="w3-modal-content w3-card-4">
    <div class="w3-container" style="min-height:300px;padding:24px;width:100%;text-align:center;">
      <div style="padding-top:20px;"><img src="./img/true.jpg" width="120px;"></div>
        <div style="padding-top:20px;color:#0056ff;padding-bottom: 30px;">ระบบได้ทำการบันทึกรายการเรียบร้อยแล้ว<br>หากต้องการแก้ไขให้กด<br>"อยู่ระหว่างตรวจสอบข้อมูล" อีกครั้ง<br><br><font color="#ff0000"><b>กรุณาตรวจสอบความถูกต้องของ<br>รหัสพนักงาน, ชื่อ-นามสกุล<br>
          หากข้อมูลไม่ถูกต้องจะไม่ได้รับอนุญาตให้เข้าใช้งาน</b></font></div>
        <div class="btn-t2" onclick="CloseAll()">ปิดหน้าต่าง</div>
      </center>
    </div>
  </div>
</div>
</body>
</html>
